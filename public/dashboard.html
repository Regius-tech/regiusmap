<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Triflex Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  body {
    margin:0;
    font-family:'Poppins',sans-serif;
    background:#001f3f;
    color:white;
  }
  header {
    background:#00264d;
    padding:15px 30px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    box-shadow:0 4px 10px rgba(0,0,0,0.4);
  }
  header img { height:40px; }
  .stats-container {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:20px;
    padding:20px;
  }
  .stat-card {
    background:#00264d;
    padding:20px;
    border-radius:12px;
    box-shadow:0 5px 15px rgba(0,0,0,0.4);
    transition:0.3s;
  }
  .stat-card:hover { transform:translateY(-5px); }
  .stat-card h3 { margin:0; font-size:18px; color:#cce6ff; }
  .stat-card p { font-size:28px; margin:5px 0; font-weight:bold; }
</style>
</head>
<body>
<header>
  <img src="triflex-logo.png" alt="Triflex">
  <span id="userEmail"></span>
</header>

<section class="stats-container">
  <div class="stat-card">
    <h3>Totalt antall biler</h3>
    <p id="totalCars">0</p>
  </div>
  <div class="stat-card">
    <h3>Aktive i dag</h3>
    <p id="activeToday">0</p>
  </div>
  <div class="stat-card">
    <h3>TS Oslo</h3>
    <p id="tsOslo">0</p>
  </div>
  <div class="stat-card">
    <h3>TS Oslo Bud</h3>
    <p id="tsOsloBud">0</p>
  </div>
  <div class="stat-card">
    <h3>Moss Transportforum</h3>
    <p id="mtf">0</p>
  </div>
  <div class="stat-card">
    <h3>Blå Kurér</h3>
    <p id="blakurer">0</p>
  </div>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCKqwpql2Yl0kbpUIPrQUYyVd7m1OeH-D8",
  authDomain: "triflex-a08c7.firebaseapp.com",
  projectId: "triflex-a08c7",
  storageBucket: "triflex-a08c7.firebasestorage.app",
  messagingSenderId: "835381689765",
  appId: "1:835381689765:web:e0be4b22e5f35ca1e0bc4c",
  databaseURL: "https://triflex-a08c7-default-rtdb.europe-west1.firebasedatabase.app"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

onAuthStateChanged(auth,user=>{
  if(!user) window.location.href='index.html';
  else document.getElementById('userEmail').textContent=user.email;
});

const updateStats = (data)=>{
  const allCars = [];
  const counts = {tsoslo:0, tsoslobud:0, mtf:0, blakurer:0, active:0};
  for(const company in data){
    const carsObj = data[company];
    for(const id in carsObj){
      const car = carsObj[id];
      allCars.push(car);
      if(car.isActiveToday) counts.active++;
      counts[company]++;
    }
  }
  document.getElementById('totalCars').textContent = allCars.length;
  document.getElementById('activeToday').textContent = counts.active;
  document.getElementById('tsOslo').textContent = counts.tsoslo;
  document.getElementById('tsOsloBud').textContent = counts.tsoslobud;
  document.getElementById('mtf').textContent = counts.mtf;
  document.getElementById('blakurer').textContent = counts.blakurer;
};

const carsRef = ref(db,'cars');
onValue(carsRef,(snapshot)=>{
  const data = snapshot.val();
  updateStats(data||{});
});
</script>
</body>
</html>
